{
    "version": "https://jsonfeed.org/version/1",
    "title": "xsh 的世界 • All posts by \"内网\" category",
    "description": "",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2024/07/22/frps/",
            "url": "http://example.com/2024/07/22/frps/",
            "title": "frpc 通过代理连接 frps",
            "date_published": "2024-07-22T14:08:23.000Z",
            "content_html": "<p>遇到了存在 a 、b、c 三台机器，a 、b 之间可以互相连接，b、c之间也可以连接，a、c 直接不能互相连接。a 、c 可以完全自由控制，b 不能控制，但是机器上存在一个只要 c 可以访问的代理端口，所以目前是 c 可以走代理访问到 a，我现在需要 a 能够访问 c，所以想要做内网穿透</p>\n<p>利用 frp + proxychains + socat</p>\n<p>frp 是内网穿透工具，但是 frpc 没有走代理的功能，所以需要用到 proxychains </p>\n<p>但是 proxychains 是原理是 hook libc，而 frp 是 go 编写的，所以需要用 socat 来转发流量</p>\n<p>假设 192.168.25.129 是 a 机器</p>\n<p><img src=\"/2024/07/22/frps/4030b244235da8bf40b745d9c7a11447.png\" alt=\"4030b244235da8bf40b745d9c7a11447\"></p>\n<p>物理机 192.168.25.1 开启了 1080 代理的是 b 机器</p>\n<p><img src=\"/2024/07/22/frps/d92a71328201ce4fa3869edf5ccc7451.png\"></p>\n<p>以及 c 机器 kali</p>\n<p><img src=\"/2024/07/22/frps/06ea416396b58825231d5a21d69eae95.png\"></p>\n<p>将 frps 放到 a 机器</p>\n<p>frsp.toml 配置如下</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bindPort = 7000</span><br><span class=\"line\">vhostHTTPPort = 8787</span><br><span class=\"line\">auth.method = &quot;token&quot;</span><br><span class=\"line\">auth.token = &quot;aaabbb&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 后台管理面板配置</span><br><span class=\"line\">webServer.port = 7500</span><br><span class=\"line\">webServer.addr = &quot;0.0.0.0&quot;</span><br><span class=\"line\">webServer.user = &quot;admin&quot;</span><br><span class=\"line\">webServer.password = &quot;pwd&quot;</span><br></pre></td></tr></table></figure>\n\n<p>将 frpc 放到 b 机器，这里我是为了能够让 gdbserver 使用才用的内网穿透，所以只映射 1234 端口，frps ip 则是本地</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">serverAddr = &quot;127.0.0.1&quot;\t\t\t</span><br><span class=\"line\">serverPort = 7000\t\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">auth.method = &quot;token&quot;</span><br><span class=\"line\">auth.token = &quot;aaabbb&quot;  \t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[[proxies]]</span><br><span class=\"line\">name = &quot;gdbserver&quot;</span><br><span class=\"line\">type = &quot;tcp&quot;\t</span><br><span class=\"line\">localIP = &quot;127.0.0.1&quot;\t\t\t\t</span><br><span class=\"line\">localPort = 1234\t\t\t\t</span><br><span class=\"line\">remotePort = 1234                   </span><br></pre></td></tr></table></figure>\n\n<p>接下来修改 &#x2F;etc&#x2F;proxychains.conf 中的 代理 ip 和 port </p>\n<p><img src=\"/2024/07/22/frps/b474b1099bfe58f161e8c67dd2cc5f5f.png\" alt=\"b474b1099bfe58f161e8c67dd2cc5f5f\"></p>\n<p>接着就可以在 kali 中利用 socat 转发流量</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proxychains socat TCP4-LISTEN:7000,reuseaddr,fork TCP4:192.168.25.129:7000</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2024/07/22/frps/d200bcb270d749f1f53f9c183f9d06d2.png\"></p>\n<p>可以将 frpc 连接到本地 7000 端口的流量通过代理发送到真正运行 frps 的 b 机器上，接着就是正常运行 frps 和 frpc</p>\n<p><img src=\"/2024/07/22/frps/ea36d43bcaee6e507d6f182622468f7f.png\"></p>\n<p>就能看到是通过 b 机器的代理访问的 frps，成功连接</p>\n<p>就是这环境太折磨人了，走了代理后的流量，gdbserver 调试个东西特卡，一个指令跑几秒</p>\n<p>参考链接：</p>\n<p><a href=\"https://oldblog.mcfx.us/archives/277/\">https://oldblog.mcfx.us/archives/277/</a></p>\n<p><a href=\"https://blog.csdn.net/laoxiaa/article/details/140474630\">https://blog.csdn.net/laoxiaa/article/details/140474630</a></p>\n<p>​\t\t\t</p>\n",
            "tags": [
                "内网穿透"
            ]
        }
    ]
}